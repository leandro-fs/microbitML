<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy Microbit ClassQuiz - Interface Web</title>
    
    <!-- Bootstrap 5 desde CDN -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Estilos personalizados -->
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container-fluid">
        <!-- Header -->
        <nav class="navbar navbar-dark bg-primary mb-3">
            <div class="container-fluid">
                <span class="navbar-brand mb-0 h1"> Proxy Microbit ClassQuiz v1.1 (Grupo:Rol)</span>
                <span class="badge bg-success" id="status-badge"> Iniciando...</span>
            </div>
        </nav>
        
        <!-- Tabs de navegaci贸n -->
        <ul class="nav nav-tabs" id="main-tabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="config-tab-btn" data-bs-toggle="tab" 
                        data-bs-target="#config-tab" type="button">
                    锔 Configuraci贸n
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="dispositivos-tab-btn" data-bs-toggle="tab" 
                        data-bs-target="#dispositivos-tab" type="button">
                     Dispositivos
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="historial-tab-btn" data-bs-toggle="tab" 
                        data-bs-target="#historial-tab" type="button">
                     Historial
                </button>
            </li>
        </ul>
        
        <!-- Contenido de tabs -->
        <div class="tab-content mt-3" id="main-tabs-content">
            
            <!-- ===== TAB 1: CONFIGURACIN ===== -->
            <div class="tab-pane fade show active" id="config-tab" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Configuraci贸n del Sistema</h5>
                        
                        <div class="mb-3">
                            <label for="url-input" class="form-label">URL de ClassQuiz:</label>
                            <input type="text" class="form-control" id="url-input" 
                                   value="http://localhost:8000"
                                   placeholder="http://localhost:8000">
                            <div class="form-text">URL del servidor ClassQuiz (incluir http://)</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="pin-input" class="form-label">Game PIN:</label>
                            <input type="text" class="form-control" id="pin-input" 
                                   value="149206"
                                   placeholder="149206">
                            <div class="form-text">C贸digo PIN del quiz en ClassQuiz</div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="timeout-input" class="form-label">Tiempo de votaci贸n (segundos):</label>
                            <input type="number" class="form-control" id="timeout-input" 
                                   value="0" min="0" max="600">
                            <div class="form-text">0 = Autom谩tico (usa tiempo de ClassQuiz - 2s lag) | Manual: 1-600s</div>
                        </div>
                        
                        <hr class="my-4">

                        <h6 class="mb-3">Gesti贸n de Archivos</h6>
                        <p class="text-muted small">
                            Guarda la configuraci贸n y los alumnos en un archivo CSV con nombre personalizado
                        </p>

                        <div class="mb-3">
                            <label for="nombre-archivo-input" class="form-label">Nombre del archivo:</label>
                            <input type="text" class="form-control" id="nombre-archivo-input"
                                   value="config_default"
                                   placeholder="ej: clase_5to_grado">
                            <div class="form-text">El archivo se guardar谩 como: nombre.csv en la carpeta "data"</div>
                        </div>

                        <div class="d-flex gap-2 mb-4">
                            <button class="btn btn-secondary" id="cargar-config-btn">
                                 Cargar Archivo
                            </button>
                            <button class="btn btn-info btn-sm" id="descubrir-btn">
                                 Descubrir Dispositivos
                            </button>
                            <button class="btn btn-primary" id="guardar-todo-btn">
                                 Guardar Archivo
                            </button>
                        </div>

                        <hr class="my-4">

                        <h6 class="mb-3">Conexi贸n a ClassQuiz</h6>
                        <p class="text-muted small">
                            Una vez descubiertos los dispositivos, con茅ctalos al quiz de ClassQuiz
                        </p>

                        <button class="btn btn-success" id="conectar-classquiz-btn">
                             Conectar a ClassQuiz
                        </button>

                        <div class="alert alert-info mt-3 d-none" id="status-conexion-alert">
                            <strong>Estado:</strong> <span id="status-conexion-texto">-</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ===== TAB 2: DISPOSITIVOS (ACTUALIZADO: con columnas Grupo y Rol) ===== -->
            <div class="tab-pane fade" id="dispositivos-tab" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <h5 class="card-title mb-0">Gesti贸n de Dispositivos</h5>
                            <div>
                                <button class="btn btn-info btn-sm" id="descubrir-btn">
                                     Descubrir Dispositivos
                                </button>
                            </div>
                        </div>
                        
                        <!-- Tabla de dispositivos (ACTUALIZADA) -->
                        <div class="table-responsive">
                            <table class="table table-striped table-hover table-sm" id="dispositivos-table">
                                <thead>
                                    <tr>
                                        <th style="width: 20%;">Device ID</th>
                                        <th style="width: 30%;">Nombre Alumno</th>
                                        <th style="width: 10%;" class="text-center">Grupo</th>
                                        <th style="width: 10%;" class="text-center">Rol</th>
                                        <th style="width: 20%;">Estado</th>
                                        <th style="width: 10%;" class="text-center">Actividad</th>
                                    </tr>
                                </thead>
                                <tbody id="dispositivos-tbody">
                                    <tr>
                                        <td colspan="6" class="text-center text-muted">
                                            Presiona "Descubrir" para detectar micro:bits
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        
                        <p class="text-muted mb-0" id="stats-text">
                            Total: 0 alumnos / 0 conectados
                        </p>
                        
                        <!-- Panel de pregunta activa (oculto por defecto) -->
                        <div class="card mt-3 d-none" id="pregunta-panel">
                            <div class="card-header bg-info text-white">
                                <strong>Control de Quiz</strong>
                            </div>
                            <div class="card-body">
                                <p class="mb-2" id="pregunta-info">
                                    <strong>Pregunta:</strong> (esperando...)
                                </p>
                                <p class="mb-3" id="countdown-info">
                                    <strong>Tiempo restante:</strong> <span class="badge bg-warning text-dark">--</span>
                                </p>
                                
                                <h6>Respuestas recibidas:</h6>
                                <ul class="list-group mb-3" id="respuestas-list">
                                    <!-- Items din谩micos -->
                                </ul>
                                
                                <button class="btn btn-warning btn-sm" id="finalizar-btn">
                                    癸 Finalizar Votaci贸n Ahora
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ===== TAB 3: HISTORIAL ===== -->
            <div class="tab-pane fade" id="historial-tab" role="tabpanel">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" 
                                       id="debug-checkbox" checked>
                                <label class="form-check-label" for="debug-checkbox">
                                    Mostrar DEBUG
                                </label>
                            </div>
                            <div>
                                <input type="text" class="form-control form-control-sm d-inline-block" 
                                       id="buscar-input" placeholder=" Buscar..." style="width: 200px;">
                                <button class="btn btn-sm btn-secondary ms-2" id="exportar-btn">
                                     Exportar
                                </button>
                            </div>
                        </div>
                        
                        <!-- Contenedor de logs -->
                        <div class="log-container" id="log-container">
                            <ul class="list-group" id="log-list">
                                <!-- Items din谩micos -->
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>
    </div>
    
    <!-- Socket.IO desde CDN -->
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
    
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- L贸gica frontend -->
    <script src="/static/js/app.js"></script>
</body>
</html>